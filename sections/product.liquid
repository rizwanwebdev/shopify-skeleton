{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/product
{% endcomment %}

  <div class="product-sec padding-inline padding-block">
      <div class="product-images">
        <div class="featured-image">
          <img
            id="featuredProductImage"
            src="{{ product.featured_image | image_url: width: 700 }}"
            alt="{{ product.title }}" width="700" height="700"
          >
        </div>

        <div class="sub-images">
          {% for image in product.images %}
            <img
              class="sub-product-image{% if image.id == product.featured_image.id %} is-active{% endif %}"
              src="{{ image | image_url: width: 150 }}"
              data-large="{{ image | image_url: width: 700 }}"
              alt="{{ product.title }}" width="150" height="150"
            >
          {% endfor %}
        </div>
      </div>


    <div class="product-details">
      <div class="product-info">
        <h2>{{ product.title }}</h2>
        <p class="small flex-row">{% render 'stars', stars_numbers: 5 %}
          {{ section.settings.star_review }}
        </p>
        <div class="product-prices">
          <p class="bold h2 primary">{{ product.price | money }}</p>
          {% if product.compare_at_price > product.price %}
          <p class="larger line-through">{{ product.compare_at_price | money }}</p>
        {% endif %}
          {% comment %} <span class="small primary font-semi">Save {{ percent_save }}</span> {% endcomment %}
        </div>
      </div>
      <div class="product-cod-form-wrapper">
        <button id="buyNowBtn" class="button button-solid" 
        data-title="{{ product.title | escape }}"
        data-id="{{ product.id }}"
        data-price="{{ product.price | money }}">
         {% render 'icon',name: 'cart', size: 26 %}
        {{ section.settings.btn_text }}
        </button>

        <!-- Hidden COD form -->
        <div id="codForm" class="cod-popup hidden">
          <div class="cod-popup-content">
            <div class="popup-title">
              <h3><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="truck-icon" style="width: 40px; height: 30px;"><path fill="currentColor" d="M19.5 8H17V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2 0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h1c.55 0 1-.45 1-1v-3.33c0-.43-.14-.85-.4-1.2L20.3 8.4c-.19-.25-.49-.4-.8-.4zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm13.5-8.5l1.96 2.5H17V9.5h2.5zM18 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path></svg> Cash On Delivery</h3>
              <span id="closeCodForm" class="cod-close">&times;</span>
            </div>
            <div class="popup-details">
              <div class="popup-product">
                <img
                src="{{ product.featured_image | image_url: width: 100 }}"
                alt="{{ product.title }}" width="100" height="100"
                >
                  <h4>{{ product.title }}</h4>
              </div>
              <div class="popup-price">
                <p><span class="larger font-semi">Product Price</span> <span class="larger font-semi">{{ product.price | money }}</span></p>
                <p><span class="larger font-semi">Shipping</span> <span class="larger font-semi">Free</span></p>
                <hr>
                <p><span class="larger font-semi">Total</span><span class="h3 font-semi foreground">{{ product.price | money }}</span></p>
              </div>
            </div>
            <form id="codOrderForm">
              <fieldset>
                <label for="name">Full Name *</label>
                <input autocomplete="name" type="text" name="name" placeholder="Full Name" required>
              </fieldset>
              <fieldset>
                <label for="phone">Phone Number *</label>
                <input autocomplete="tel" type="tel" name="phone" placeholder="Phone Number" required>
              </fieldset>
              <fieldset>
                <label for="address">Delivery Address *</label>
                <input autocomplete="addres" type="text" name="address" placeholder="Delivery Address" required>
              </fieldset>
              <fieldset>
                <label for="city">City *</label>
                <input autocomplete="city" type="text" name="City" placeholder="Your City" required>
              </fieldset>
              <button id="submitBtn" type="submit" class="button button-outline">{% render 'icon', name: 'cart' %} Place Order</button>
            </form>
          </div>
        </div>
      </div>
      <div class="product-included">
        <h6>What's Included</h6>
        <ul>
          {% for block in section.blocks %}
            <li class="flex-row">{% render 'icon', name: block.settings.i_icon %} <p class="smaller foreground">{{ block.settings.text }}</p></li>
          {% endfor %}
        </ul>

      </div>
      <p>{{ product.description }}</p>
      <div class="text-icon">
        <div>
          {% render 'icon', name: 'shield' %}
          <p>Money back Guarantee</p>
        </div>
        <div>
          {% render 'icon', name: 'truck' %}
          <p>Free Shipping</p>
        </div>
        <div>
          {% render 'icon', name: 'award' %}
          <p>FDA Approved</p>
        </div>
        <div>
          {% render 'icon', name: 'card' %}
          <p>Cash-On Delievry</p>
        </div>

      </div>
    </div>
  </div>
{% stylesheet %}
  .product-sec{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
  }
  .product-prices,
  .text-icon > div,
  .flex-row{
    display: flex;
    flex-direction: row;
    gap: 8px;
    align-items: center;
  }
  .product-details,
  .product-included,
  .product-info,
  .product-images{
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .featured-image{
    display: flex;
    flex-direction: column;
    gap: 24px;
    border-radius: 16px;
    border: 2px solid var(--color-border);
    overflow: hidden;

  }
  .sub-images{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 16px;
    overflow: hidden;
  }.sub-product-image{
    border: 2px solid var(--color-border);
    border-radius: 8px;
    cursor: pointer;
  }
  .sub-product-image.is-active {
    border-color: var(--color-primary);
  }
  #featuredProductImage {
    transition: opacity 0.2s ease;
  }
 
  .product-prices span{
    background: var(--color-card);
    border-radius: 40px;
    padding: 2px 6px;
    border: 1px solid var(--color-border);
  }
  .product-included{
    padding: 16px;
    border-radius: 8px;
    border: 1px solid var(--color-border);
    background: var(--color-section);
  }
  .product-included ul{
    display: flex;
    flex-direction: column;
    gap: 8px;
    list-style: none;
  }
  .product-included svg{
    min-width: 16px;
    min-height: 16px;
  }
  .text-icon{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  /* ============cod-form=================== */
  #buyNowBtn,
  #submitBtn{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
    margin-block: 1rem;
  }
    #submitBtn{
      align-self: flex-end;
    }
  #submitBtn:hover svg,
  #buyNowBtn svg{
    stroke: var(--color-netural);
    transition: all .3s;
  }
  #submitBtn svg,
  #buyNowBtn:hover svg{
    stroke: var(--color-primary);
  }
  .cod-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  max-height: 100vh;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  }

  .cod-popup.hidden {
    display: none;
  }

  .cod-popup-content {
    background: #fff;
    padding: 24px;
    border-radius: 16px;
    width: 90%;
    max-width:500px;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }
  .cod-popup-content form{
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .popup-title{
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 16px;
    border-bottom: 1px solid var(--color-border);
  }.popup-title h3{
    flex: 1;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    text-align: center;
  }
  .popup-product{
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 8px;
    padding: 8px;
    border: 2px solid var(--color-border);
    border-radius: 8px;
  }

  .cod-close {
    cursor: pointer;
    font-size: 2.5rem;
  }
  #codOrderForm fieldset{
    display: flex;
    flex-direction: column;
    gap: 4px;
    outline: none;
    border: none;
  }
  .popup-price{
    margin-top: 1rem;
   display: flex;
   flex-direction: column;
   gap: 8px;
   padding: 8px;
    border: 2px solid var(--color-border);
    border-radius: 8px;
    background: var(--color-card);
  }
  .popup-price hr{
    border-color: var(--color-border);
  }
  .popup-price p{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
  }

   #codOrderForm fieldset label{
    color: var(--color-foreground);
   }
  #codOrderForm input{
    outline: none;
    border: 1px solid var(--color-border);
    padding: 12px 8px;
    font-size: 18px;
  }
  /* ============cod-form=================== */

  @media screen and (max-width:767px){
     .product-sec{
      grid-template-columns: 1fr;
     }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', () => {
    const featuredImage = document.getElementById('featuredProductImage');
    const thumbnails = document.querySelectorAll('.sub-product-image');

    if (!featuredImage || !thumbnails.length) return;

    thumbnails.forEach((thumb) => {
      thumb.addEventListener('click', () => {
        featuredImage.style.opacity = 0;
          featuredImage.src = thumb.dataset.large;
          featuredImage.style.opacity = 1;
        thumbnails.forEach(t => t.classList.remove('is-active'));
        thumb.classList.add('is-active');
      });
    });

    const buyBtn = document.getElementById('buyNowBtn');
  const codForm = document.getElementById('codForm');
  const closeBtn = document.getElementById('closeCodForm');
  const codOrderForm = document.getElementById('codOrderForm');

  // Open COD popup
  buyBtn.addEventListener('click', () => {
    codForm.classList.remove('hidden');
  });

  // Close popup
  closeBtn.addEventListener('click', () => {
    codForm.classList.add('hidden');
  });

  // Submit COD form
  codOrderForm.addEventListener('submit', (e) => {
    e.preventDefault();

    // Collect form data
    const formData = new FormData(codOrderForm);
    const buyBtn = document.getElementById('buyNowBtn');
      buyBtn.addEventListener('click', () => {
        const order = {
          title: buyBtn.dataset.title,
          id: buyBtn.dataset.id,
          price: buyBtn.dataset.price
        };
        console.log('COD Order:', order);
      });

    console.log('COD Order Submitted:', order);

    // For now just alert — later you can send to backend / email / Google Sheet
    alert('Thank you! Your COD order has been received.');

    // Close popup & reset form
    codForm.classList.add('hidden');
    codOrderForm.reset();
  });
  });
{% endjavascript %}
{% schema %}
  {
    "name": "t:general.product",
    "settings": [
      {
        "type": "text",
        "id": "star_review",
        "label": "Star Reviews"
      },{
        "type": "text",
        "id": "btn_text",
        "label": "Button Text"
      },
      {
        "type": "checkbox",
        "id": "show_add_to_cart",
        "label": "Show Add to cart", 
        "default": false
      }
    ],"blocks": [
      {
        "type": "included",
        "name":"Include",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "t:labels.text"
          },{
            "type": "select",
            "id": "i_icon",
            "label": "Pick Icon",
            "options": [
              {"value": "star", "label": "Star"},
              {"value": "truck", "label": "Truck"},
              {"value": "heart", "label": "Heart"},
              {"value": "dollar", "label": "Dollar"},
              {"value": "award", "label": "Award"},
              {"value": "message", "label": "Message"},
              {"value": "circle-check", "label": "Circle Check"},
              {"value": "clock", "label": "Clock"}
            ]
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Product Details",
        "settings": {
          "star_review":"(2847 reviews)",
          "btn_text":"Buy with Cash on Delivery"
        },
        "blocks": [
          {
            "type": "included",
            "settings": {
              "text":"High-Quality Ingredients"
            }

          },{
            "type": "included",
            "settings": {
              "text":"Crystal-White Results in 3–7 Days"
            }

          },{
            "type": "included",
            "settings": {
              "text":"Cash on Delivery Across Pakistan"
            }

          },{
            "type": "included",
            "settings": {
              "text":"Fast WhatsApp Support"
            }

          }
        ]
      }
    ],
    "disabled_on": {
      "groups": ["header", "footer"]
    }
  }
{% endschema %}
