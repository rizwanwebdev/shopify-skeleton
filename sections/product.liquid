{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/product
{% endcomment %}

<div class="product-sec padding-inline padding-block">
    <div class="product-images">
  <div class="featured-image">
    <img
      id="featuredProductImage"
      src="{{ product.featured_image | image_url: width: 700 }}"
      alt="{{ product.title }}" width="700" height="700"
    >
  </div>

  <div class="sub-images">
    {% for image in product.images %}
      <img
         class="sub-product-image{% if image.id == product.featured_image.id %} is-active{% endif %}"
        src="{{ image | image_url: width: 150 }}"
        data-large="{{ image | image_url: width: 700 }}"
        alt="{{ product.title }}" width="150" height="150"
      >
    {% endfor %}
  </div>
</div>


    <div class="product-details">
      <div class="product-info">
        <h1>{{ product.title }}</h1>
        <p class="small flex-row">{% render 'stars', stars_numbers: 5 %}
          {{ section.settings.star_review }}
        </p>
        <div class="product-prices">
          <p class="bold h2 danger">{{ product.price | money }}</p>
          {% if product.compare_at_price > product.price %}
          <p class="larger line-through">{{ product.compare_at_price | money }}</p>
        {% endif %}
          {% comment %} <span class="small primary font-semi">Save {{ percent_save }}</span> {% endcomment %}
        </div>
        <p>{{ product.description }}</p>
      </div>
      <div class="product-included">
        <h6>What's Included</h6>
        <ul>
          {% for block in section.blocks %}
            <li class="flex-row">{% render 'icon', name: block.settings.i_icon %} <p class="smaller foreground">{{ block.settings.text }}</p></li>
          {% endfor %}
        </ul>

      </div>

      <div class="product-cod-form-wrapper">
        <button id="buyNowBtn" class="button button-solid" 
        data-title="{{ product.title | escape }}"
        data-id="{{ product.id }}"
        data-price="{{ product.price | money }}">
         {% render 'icon',name: 'cart', size: 26 %}
        Buy Now
        </button>

        <!-- Hidden COD form -->
        <div id="codForm" class="cod-popup hidden">
          <div class="cod-popup-content">
            <span id="closeCodForm" class="cod-close">&times;</span>
            <h3>Cash On Delivery Details</h3>
            <form id="codOrderForm">
              <input type="text" name="name" placeholder="Full Name" required>
              <input type="tel" name="phone" placeholder="Phone Number" required>
              <input type="text" name="address" placeholder="Delivery Address" required>
              <textarea name="notes" placeholder="Notes (optional)"></textarea>
              <button type="submit" class="button button-outline">Place Order</button>
            </form>
          </div>
        </div>
      </div>

      <div class="text-icon">
        <div>
          {% render 'icon', name: 'shield' %}
          <p>Money back Guarantee</p>
        </div>
        <div>
          {% render 'icon', name: 'truck' %}
          <p>Free Shipping</p>
        </div>
        <div>
          {% render 'icon', name: 'award' %}
          <p>FDA Approved</p>
        </div>
        <div>
          {% render 'icon', name: 'card' %}
          <p>Cash-On Delievry</p>
        </div>

      </div>
    </div>
  </div>
{% stylesheet %}
  .product-sec{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
  }
  .product-prices,
  .text-icon > div,
  .flex-row{
    display: flex;
    flex-direction: row;
    gap: 8px;
    align-items: center;
  }
  .product-details,
  .product-included,
  .product-info,
  .product-images{
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .featured-image{
    display: flex;
    flex-direction: column;
    gap: 24px;
    border-radius: 16px;
    border: 2px solid var(--color-border);
    overflow: hidden;

  }
  .sub-images{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 16px;
    overflow: hidden;
  }.sub-product-image{
    border: 2px solid var(--color-border);
    border-radius: 8px;
    cursor: pointer;
  }
  .sub-product-image.is-active {
    border-color: var(--color-primary);
  }
  #featuredProductImage {
    transition: opacity 0.2s ease;
  }
 
  .product-prices span{
    background: var(--color-card);
    border-radius: 40px;
    padding: 2px 6px;
    border: 1px solid var(--color-border);
  }
  .product-included{
    padding: 16px;
    border-radius: 8px;
    border: 1px solid var(--color-border);
    background: var(--color-section);
  }
  .product-included ul{
    display: flex;
    flex-direction: column;
    gap: 8px;
    list-style: none;
  }
  .product-included svg{
    min-width: 16px;
    min-height: 16px;
  }
  .text-icon{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  /* ============cod-form=================== */
  #buyNowBtn{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
  }
  #buyNowBtn svg{
    stroke: var(--color-netural);
  }
    #buyNowBtn svg:hover{
    stroke: var(--color-primary);
  }
  .cod-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  }

  .cod-popup.hidden {
    display: none;
  }

  .cod-popup-content {
    background: #fff;
    padding: 24px;
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
    position: relative;
  }

  .cod-close {
    position: absolute;
    top: 12px;
    right: 16px;
    cursor: pointer;
    font-size: 20px;
  }
  /* ============cod-form=================== */

  @media screen and (max-width:767px){
     .product-sec{
      grid-template-columns: 1fr;
     }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', () => {
    const featuredImage = document.getElementById('featuredProductImage');
    const thumbnails = document.querySelectorAll('.sub-product-image');

    if (!featuredImage || !thumbnails.length) return;

    thumbnails.forEach((thumb) => {
      thumb.addEventListener('click', () => {
        featuredImage.style.opacity = 0;
          featuredImage.src = thumb.dataset.large;
          featuredImage.style.opacity = 1;
        thumbnails.forEach(t => t.classList.remove('is-active'));
        thumb.classList.add('is-active');
      });
    });

    const buyBtn = document.getElementById('buyNowBtn');
  const codForm = document.getElementById('codForm');
  const closeBtn = document.getElementById('closeCodForm');
  const codOrderForm = document.getElementById('codOrderForm');

  // Open COD popup
  buyBtn.addEventListener('click', () => {
    codForm.classList.remove('hidden');
  });

  // Close popup
  closeBtn.addEventListener('click', () => {
    codForm.classList.add('hidden');
  });

  // Submit COD form
  codOrderForm.addEventListener('submit', (e) => {
    e.preventDefault();

    // Collect form data
    const formData = new FormData(codOrderForm);
    const buyBtn = document.getElementById('buyNowBtn');
      buyBtn.addEventListener('click', () => {
        const order = {
          title: buyBtn.dataset.title,
          id: buyBtn.dataset.id,
          price: buyBtn.dataset.price
        };
        console.log('COD Order:', order);
      });

    console.log('COD Order Submitted:', order);

    // For now just alert — later you can send to backend / email / Google Sheet
    alert('Thank you! Your COD order has been received.');

    // Close popup & reset form
    codForm.classList.add('hidden');
    codOrderForm.reset();
  });
  });
{% endjavascript %}
{% schema %}
  {
    "name": "t:general.product",
    "settings": [
      {
        "type": "text",
        "id": "star_review",
        "label": "Star Reviews"
      },
      {
        "type": "checkbox",
        "id": "show_add_to_cart",
        "label": "Show Add to cart", 
        "default": false
      }
    ],"blocks": [
      {
        "type": "included",
        "name":"Include",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "t:labels.text"
          },{
            "type": "select",
            "id": "i_icon",
            "label": "Pick Icon",
            "options": [
              {"value": "star", "label": "Star"},
              {"value": "truck", "label": "Truck"},
              {"value": "heart", "label": "Heart"},
              {"value": "dollar", "label": "Dollar"},
              {"value": "award", "label": "Award"},
              {"value": "message", "label": "Message"},
              {"value": "circle-check", "label": "Circle Check"},
              {"value": "clock", "label": "Clock"}
            ]
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Product Details",
        "settings": {
          "star_review":"(2847 reviews)"
        },
        "blocks": [
          {
            "type": "included",
            "settings": {
              "text":"High-Quality Ingredients"
            }

          },{
            "type": "included",
            "settings": {
              "text":"Crystal-White Results in 3–7 Days"
            }

          },{
            "type": "included",
            "settings": {
              "text":"Cash on Delivery Across Pakistan"
            }

          },{
            "type": "included",
            "settings": {
              "text":"Fast WhatsApp Support"
            }

          }
        ]
      }
    ],
    "disabled_on": {
      "groups": ["header", "footer"]
    }
  }
{% endschema %}
